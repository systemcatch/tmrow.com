<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="We want to propel humanity to a sustainable state of existence by quantifying, and making widely accessible, the impact of every choice we make" />
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="img/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta property="og:description" content="We want to propel humanity to a sustainable state of existence by quantifying, and making widely accessible, the impact of every choice we make" />
    <meta property="og:url" content="http://www.tmrow.co" />
    <meta property="og:image" content="http://www.tmrow.co/img/tmrow-social.jpg" />
    <meta property="og:title" content="Tomorrow - Quantifying the impact of every choice we make" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="We want to propel humanity to a sustainable state of existence by quantifying, and making widely accessible, the impact of every choice we make" />
    <meta name="twitter:image" content="http://www.tmrow.co/img/tmrow-social.jpg">
    <meta name="twitter:site" content="@tmrowco">
    <meta name="twitter:title" content="Tomorrow - Quantifying the impact of every choice we make" />
    <link rel="apple-touch-icon" sizes="57x57" href="img/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="img/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="img/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="img/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="img/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="img/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="img/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="img/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
    <link rel="manifest" href="img/favicon/manifest.json">
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css?family=Lato:300i,400" rel="stylesheet">
    <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">    
    <!--[if lt IE 9]>
      <script src="bower_components/html5shiv/dist/html5shiv.js"></script>
    <![endif]-->
    <title>Tomorrow</title>
    <!-- start Mixpanel -->
    <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
    for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
    mixpanel.init("62254a092953432d14177a334646064c");</script>
  <!-- end Mixpanel -->
  <!-- start GA -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-79729918-2', 'auto');
  </script>
  <!-- end GA -->
  </head>
  <body>
    <!-- start Twitter -->
    <script>
        window.twttr = (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
        t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function(f) {
            t._e.push(f);
        };

        return t;
        }(document, "script", "twitter-wjs"));
    </script>
    <!-- end Twitter -->
    <!-- Load Facebook SDK for JavaScript -->
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    <header id="main-header">
      <div id="header-content">
        <a href="index.html" title="Tomorrow">
          <img class="svg logo" src="img/logo_with_tagline.svg"/>
          <img class="svg logo mobile" src="img/logo_with_tagline_stacked.svg"/>
        </a>
        <ul class="menu">
          <li class="email"><a href="mailto:hello@tmrow.co"><i class="fa fa-envelope" aria-hidden="true"></i> Contact</a></li>
          <li class="blog"><a href="https://medium.com/tmrow" target="_blank"><i class="fa fa-medium" aria-hidden="true"></i> Blog</a></li>
          <li class="projects"><a href="projects"><i class="fa fa-flask" aria-hidden="true"></i> Projects</a></li>
          <li class="team"><a href="team.html"><i class="fa fa-users" aria-hidden="true"></i> Team</a></li>
        </ul>
      </div>
    </header>
    <div id="main">
      <div id="main-content">
        <h2>Impact des imports sur l'intensité carbone de l'électricité en France</h2>
        <div id="graph" style="background-color: white;">
          <canvas id="chart"></canvas>
        </div>
        <div>
          <p>
          Aujourd'hui, à <span id="current-time" style="font-weight: bold"></span>:
            <small><ul>
                <li> La France produit <strong><span id="total-production"></span> GW d'électricité</strong>, correspondant à une intensité carbone de <strong><span id="total-production-emissions"></span> tonnes de CO2 par minute.</strong></li>
                <li id="import-line"> La France importe <strong><span id="total-net-import"></span> GW d'électricité</strong>, correspondant à une intensité carbone de <strong><span id="total-net-import-emissions"></span> tonnes de CO2 par minute.</strong></li>
                <li id="export-line"> La France exporte <strong><span id="total-net-export"></span> GW d'électricité</strong>, correspondant à une intensité carbone de <strong><span id="total-net-export-emissions"></span> tonnes de CO2 par minute.</strong></li>
                <li id="explanation-line"> Ainsi, la France importe <strong><span id="import-percentage"></span>% de son électricité</strong> qui compte pour <strong><span id="import-emissions-percentage"></span>% de ses émissions de CO2</strong> liées à la consommation électrique.</li>
            </ul></small>
          </p>
          <p> Toutes les données utilisées sur cette page proviennent de l'<a href="http://electricitymap.tmrow.co" target="_blank" style="color: lightblue"><strong>Electricity Map</strong></a>.
          </p> 

          <script src="https://d3js.org/d3.v4.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
          <script>

            var handleClick;
            var chart;
            var redraw;
            function getLast(arr) {
              return arr && arr.length && arr[arr.length - 1] || undefined;
            }

            d3.json('http://electricitymap.tmrow.co/v2/co2LastDay?countryCode=FR', function(err, obj) {
              console.log(obj);

              // We only work in GW here

              var productionCO2Intensity = obj.data.map(function(zone) {
                // Weighted average in g/MWh
                var Z = d3.entries(zone.production).map(function(o) {
                  return (zone.productionCo2Intensities[o.key] * 1e3) * (o.value);
                }).reduce(function(a,b) { return a + b });
                Z = Z / d3.sum(d3.values(zone.production));
                return {
                  x: moment(zone.datetime),
                  y: Z * 1e3 // in g/GWh
                }
              });
              var production = obj.data.map(function(zone) {
                return {
                  x: moment(zone.datetime),
                  y: zone.totalProduction / 1e3
                }
              });
              var productionCO2Mass = obj.data.map(function(_, i) {
                return {
                  x: production[i].x,
                  y: production[i].y * productionCO2Intensity[i].y
                }
              });

              var negativeExchanges = obj.data.map(function(zone) {
                // Sum all exchanges
                return {
                  x: moment(zone.datetime),
                  y: Math.min(d3.sum(d3.values(zone.exchange)), 0) / 1000.0
                }
              });
              var positiveExchanges = obj.data.map(function(zone) {
                // Sum all exchanges
                return {
                  x: moment(zone.datetime),
                  y: Math.max(d3.sum(d3.values(zone.exchange)), 0) / 1000.0
                }
              });
              var exchangesCO2Mass = obj.data.map(function(zone) {
                // Scalar product
                var value = d3.entries(zone.exchange).map(function(o) {
                  return (zone.exchangeCo2Intensities[o.key] * 1e6) * (o.value / 1e3);
                }).reduce(function(a,b) { return a + b });
                return {
                  x: moment(zone.datetime),
                  y: value
                }
              });
              var positiveExchangesCO2Mass = exchangesCO2Mass.map(function(d) {
                return {x: d.x, y: Math.max(d.y, 0)}
              });
              var negativeExchangesCO2Mass = exchangesCO2Mass.map(function(d) {
                return {x: d.x, y: Math.min(d.y, 0)}
              });

              handleClick = function(evt) {
                var activeElement = chart.getElementAtEvent(evt);
                var i = activeElement[0] && activeElement[0]._index || undefined;
                redraw(i);
              }

              redraw = function(i) {

                function get(arr) {
                  return (i === undefined) ? getLast(arr) : arr[i]
                }

                var lastImportPercentage = get(positiveExchanges).y /
                  get(production).y * 100.0;
                var lastImportCO2MassPercentage = get(positiveExchangesCO2Mass).y /
                  get(productionCO2Mass).y * 100.0;
                var isImporting = get(positiveExchanges).y > 0;

                document.getElementById('current-time').innerHTML = 
                  moment(get(production).x).format('LT');
                document.getElementById('total-production').innerHTML = 
                  d3.format('.1f')(get(production).y);
                document.getElementById('total-production-emissions').innerHTML = 
                  d3.format('.0f')(get(productionCO2Mass).y / 60.0 / 1e6);

                document.getElementById('import-line').style.display = isImporting ? 'list-item' : 'none';
                document.getElementById('total-net-import').innerHTML = 
                  d3.format('.1f')(get(positiveExchanges).y);
                document.getElementById('total-net-import-emissions').innerHTML = 
                  d3.format('.0f')(get(positiveExchangesCO2Mass).y / 60.0 / 1e6);

                document.getElementById('export-line').style.display = !isImporting ? 'list-item' : 'none';
                document.getElementById('total-net-export').innerHTML = 
                  d3.format('.2f')(get(negativeExchanges).y);
                document.getElementById('total-net-export-emissions').innerHTML = 
                  d3.format('.0f')(get(negativeExchangesCO2Mass).y / 60.0 / 1e6);

                document.getElementById('explanation-line').style.display = isImporting ? 'list-item' : 'none';

                document.getElementById('import-percentage').innerHTML = 
                  d3.format('.1f')(lastImportPercentage);
                document.getElementById('import-emissions-percentage').innerHTML = 
                  d3.format('.1f')(lastImportCO2MassPercentage);
              }

              redraw();

              var ctx = document.getElementById('chart');
              chart = new Chart(ctx, {
                type: 'line',
                data: {
                  datasets: [
                    {
                      label: 'Exportation (GW)',
                      data: negativeExchanges,
                      backgroundColor: '#5ab4ac'
                    },
                    {
                      label: 'Production (GW)',
                      data: production,
                      backgroundColor: '#ffffbf'
                    },
                    {
                      label: 'Importation (GW)',
                      data: positiveExchanges,
                      backgroundColor: '#d8b365'
                    }
                  ]
                },
                options: {
                  scales: {
                    xAxes: [{
                      type: 'time',
                      time: {
                          displayFormats: {
                            hour: 'LT'
                          },
                          tooltipFormat: 'LLLL'
                      }
                    }],
                    yAxes: [{
                      stacked: true
                    }]
                  },
                  onClick: handleClick
                }
              })
            })

          </script>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      if (window.location.href.indexOf('www.tmrow.co') !== -1) {
        mixpanel.track('Pageview');
        ga('send', 'pageview');
      }
    </script>
  </body>
</html>
